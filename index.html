<html>
<head>
<script type="text/javascript" charset="utf-8">
var p5 = window;
var startedAt = 0;
var currentFrame = 0;
</script>
<script src="http://qua.local:8000/socket.io/socket.io.js"></script>
<script language="javascript" type="text/javascript" src="p5/dist/p5.js"></script>
<script language="javascript" type="text/javascript" src="body.js"></script>
<script language="javascript" type="text/javascript" src="map.js"></script>
<script language="javascript" type="text/javascript" src="food.js"></script>
<script language="javascript" type="text/javascript" src="simulation.js"></script>
<script language="javascript" type="text/javascript" src="log.js"></script>

<script>
if (typeof io != "undefined") {
  var socket = io.connect('http://qua.local:8000');
  socket.on('setup', function(data) {
    var map = data.map;
    m = new Map(map.w, map.h, false);
    for (var i = 0; i < map.food.length; i ++) {
      var tempf = map.food[i];
      var f = new Food(tempf.location.x, tempf.location.y, tempf.r);
      updateAttributes(f, tempf);
      m.food.push(f);
    }
    bodies = [];
    currentFrame = data.startedAt;
    for (var i = 0; i < data.bodies.length; i ++) {
      var b = data.bodies[i];
      var b2 = new Body(b.location.x, b.location.y, b.name);
      updateAttributes(b2, b);
      bodies.push(b2);
    }
    randomseed(data.seed);
  });

  setInterval(function() {
    socket.emit('ping', {clientMoments: currentFrame});
  }, 100);

  socket.on('timecheck', function(data) {
    //total frames between now and next check = 1000/frameRate
    //frames needed = total + diff *-1
    //1000/x = frames, frames*x = 1000, x = 1000/frames
   // var diff = currentFrame - data.totalMoments;
   // if (Math.abs(diff) > 1) {
   //   var framesNeeded = 1000/frameRate + diff;
   //   setFrameRate(1000/framesNeeded);
   //   console.log("dif: " + diff);
   //   console.log(frameRate);
   //   } else {
   //   setFrameRate(30);
   //   }
  });
}
</script>
<style type="text/css" media="all">
body { background: #333; }
//canvas {left: 50% !important; margin-left: -640px; top: 50% !important; margin-top: -360px; }
</style>
</head>

<body>
<textarea id="log" style="float:right; margin:0; padding:0; background: #333; color: #fff; border:0; width: 300px; height: 720;"></textarea>
</body>
</html>
